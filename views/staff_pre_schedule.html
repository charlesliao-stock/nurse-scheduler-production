<div class="page-section active" style="padding:0; height:100vh; display:flex; flex-direction:column;">
    
    <div style="padding:15px 20px; background:white; border-bottom:1px solid #ddd; display:flex; align-items:center; justify-content:space-between; flex-shrink:0;">
        <div style="display:flex; align-items:center; gap:15px;">
            <button class="btn" onclick="history.back()" style="background:#95a5a6;">
                <i class="fas fa-arrow-left"></i> 返回列表
            </button>
            <h3 style="margin:0;" id="staffPreTitle">載入中...</h3>
            <span id="staffPreStatus" class="badge"></span>
        </div>
        <div>
            <button class="btn btn-add" id="btnStaffSave" onclick="staffPreScheduleManager.saveRequest()">
                <i class="fas fa-save"></i> 提交預班
            </button>
        </div>
    </div>

    <div style="flex:1; overflow:hidden; display:flex; background:#f4f6f8;">
        
        <div style="flex:1; padding:20px; overflow-y:auto;" id="calendarContainer">
            <div id="calendarGrid" class="calendar-grid"></div>
        </div>

        <div style="width:340px; background:white; border-left:1px solid #ddd; padding:20px; display:flex; flex-direction:column; overflow-y:auto;">
            
            <h4 style="margin-top:0; border-bottom:2px solid #3498db; padding-bottom:10px; color:#2c3e50;">
                <i class="fas fa-user-clock"></i> 我的預班統計
            </h4>

            <div id="specialStatusArea" style="margin-bottom:15px; display:none;">
                <span class="badge" style="background:#e67e22; margin-right:5px;" id="badgePregnant">懷孕中</span>
                <span class="badge" style="background:#d35400;" id="badgeBreastfeeding">哺乳中</span>
            </div>

            <div class="stat-card" style="background:#eaf2f8; padding:15px; border-radius:8px; margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                    <span>總預休天數:</span>
                    <span style="font-weight:bold;"><span id="statOffCount">0</span> / <span id="limitMaxOff">-</span></span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span>假日預休:</span>
                    <span style="font-weight:bold;"><span id="statHolidayOffCount">0</span> / <span id="limitMaxHoliday">-</span></span>
                </div>
            </div>

            <h4 style="border-bottom:2px solid #e67e22; padding-bottom:10px; color:#2c3e50;">
                <i class="fas fa-sliders-h"></i> 排班偏好
            </h4>

            <div class="form-group" id="bundleGroup" style="margin-bottom:20px; display:none;">
                <label style="font-weight:bold;">包班意願</label>
                <select id="inputBundleShift" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; margin-top:5px;">
                    <option value="">無 (不包班)</option>
                </select>
                <small style="color:#7f8c8d;">僅列出開放包班的項目</small>
            </div>

            <div class="form-group" id="prefGroup" style="margin-bottom:20px;">
                <label style="font-weight:bold;">班別志願序 (夜班偏好)</label>
                <div id="prefContainer" style="margin-top:5px; display:flex; flex-direction:column; gap:8px;">
                    <div style="color:#999; font-size:0.9rem;">載入中...</div>
                </div>
            </div>

            <div style="margin-top:auto; padding-top:20px; border-top:1px solid #eee; color:#7f8c8d; font-size:0.9rem;">
                <p><i class="fas fa-info-circle"></i> 說明:</p>
                <ul style="padding-left:20px; margin:0;">
                    <li><b>左鍵點擊</b>:切換預休 (綠色)。</li>
                    <li><b>右鍵點擊</b>:開啟選單 (指定班別/清除)。</li>
                    <li><span style="color:#e67e22; font-weight:bold;">橘框</span>:名額充足。</li>
                    <li><span style="color:#e74c3c; font-weight:bold;">紅框</span>:名額已滿。</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- [關鍵修正] 確保選單容器結構正確 -->
<div id="staffContextMenu" class="context-menu" style="display:none;">
    <div class="menu-header" id="staffMenuTitle">設定班別</div>
    <div id="staffMenuOptions"></div>
</div>
