<div class="page-section active">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0;"><i class="fas fa-calendar-alt"></i> 預班管理</h2>
    </div>
    
    <div class="toolbar">
        <label style="margin-right:10px; font-weight:bold;">選擇單位：</label>
        <select id="filterPreUnit" style="padding:8px; border-radius:4px; border:1px solid #ccc; width: 200px;">
            <option value="">載入中...</option>
        </select>
        
        <div style="margin-left:auto;">
            <button id="btnAddPreSchedule" class="btn btn-add" onclick="preScheduleManager.openModal()">
                <i class="fas fa-plus"></i> 新增預班表
            </button>
        </div>
    </div>

    <div class="table-container">
        <table id="preScheduleTable">
            <thead>
                <tr>
                    <th style="width: 15%;">預班月份</th>
                    <th style="width: 25%;">開放區間</th>
                    <th style="width: 20%;">預班進度 (已交/總數)</th>
                    <th style="width: 15%;">狀態</th>
                    <th style="width: 25%;">操作</th>
                </tr>
            </thead>
            <tbody id="preScheduleTableBody">
                </tbody>
        </table>
    </div>
</div>

<div id="preScheduleModal" class="modal">
    <div class="modal-content" style="max-width: 850px; height: 85vh; display: flex; flex-direction: column;">
        
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px;">
            <h3 style="margin:0;">預班表設定</h3>
            <button class="btn btn-import" id="btnImportLast" onclick="preScheduleManager.importLastSettings()" style="font-size:0.9rem; padding:5px 10px;">
                <i class="fas fa-history"></i> 帶入上月設定
            </button>
        </div>

        <input type="hidden" id="preScheduleDocId">
        <input type="hidden" id="currentMode">

        <div class="tab-header">
            <button class="tab-btn active" onclick="preScheduleManager.switchTab('basic')">1. 基本與規則</button>
            <button class="tab-btn" onclick="preScheduleManager.switchTab('limits')">2. 組別人力限制</button>
            <button class="tab-btn" onclick="preScheduleManager.switchTab('staff')">3. 參與人員</button>
        </div>

        <div style="flex: 1; overflow-y: auto; padding-right: 10px;">
            
            <div id="tab-basic" class="tab-content active">
                <h4 style="color:#2c3e50; border-left:4px solid #3498db; padding-left:10px;">基本資料</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>預班年份</label>
                        <input type="number" id="inputPreYear">
                    </div>
                    <div class="form-group">
                        <label>預班月份</label>
                        <select id="inputPreMonth">
                            <option value="1">1月</option><option value="2">2月</option><option value="3">3月</option>
                            <option value="4">4月</option><option value="5">5月</option><option value="6">6月</option>
                            <option value="7">7月</option><option value="8">8月</option><option value="9">9月</option>
                            <option value="10">10月</option><option value="11">11月</option><option value="12">12月</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>開放日期 (起) *</label>
                        <input type="date" id="inputOpenDate">
                    </div>
                    <div class="form-group">
                        <label>截止日期 (迄) *</label>
                        <input type="date" id="inputCloseDate">
                    </div>
                </div>
                <div class="form-group">
                    <label style="cursor:pointer; display:inline-flex; align-items:center;">
                        <input type="checkbox" id="checkShowAllNames" style="width:auto; margin-right:8px;">
                        顯示所有預班者姓名 (公開透明)
                    </label>
                </div>

                <hr style="border:0; border-top:1px dashed #ccc; margin:20px 0;">

                <h4 style="color:#2c3e50; border-left:4px solid #e67e22; padding-left:10px;">預班限制</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>預班上限天數 (含假日)</label>
                        <input type="number" id="inputMaxOff" placeholder="例如: 8">
                    </div>
                    <div class="form-group">
                        <label>假日上限天數</label>
                        <input type="number" id="inputMaxHoliday" placeholder="例如: 2">
                    </div>
                    <div class="form-group">
                        <label>每日預班名額保留數</label>
                        <input type="number" id="inputDailyReserve" placeholder="例如: 2">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>排班夜班模式</label>
                        <select id="inputShiftMode" onchange="preScheduleManager.toggleThreeShiftOption()">
                            <option value="2">2種 (白/夜 - 固定班)</option>
                            <option value="3">3種 (白/小/大 - 花班)</option>
                        </select>
                    </div>
                    <div class="form-group" id="divAllowThree" style="display:none;">
                        <label>3種班意願選項</label>
                        <div style="margin-top:10px;">
                            <label style="cursor:pointer;">
                                <input type="checkbox" id="checkAllowThree" style="width:auto;"> 
                                同意同仁自願選擇 3 種班
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-limits" class="tab-content">
                <div class="alert-box" style="background:#e8f6f3; color:#0e6251; padding:10px; border-radius:4px; margin-bottom:15px; font-size:0.9rem;">
                    <i class="fas fa-info-circle"></i> 請輸入各組別每日最少/最多需上班的人數限制。
                </div>
                <div style="overflow-x:auto;">
                    <table class="matrix-table" id="groupLimitTable">
                        </table>
                </div>
            </div>

            <div id="tab-staff" class="tab-content">
                <div style="background:#f9f9f9; padding:15px; border-radius:4px; margin-bottom:15px; display:flex; gap:10px;">
                    <input type="text" id="inputSearchStaff" placeholder="搜尋全院員工 (員編/姓名)..." style="flex:1; padding:8px; border:1px solid #ccc; border-radius:4px;">
                    <button class="btn btn-add" onclick="preScheduleManager.searchAndAddSupport()">加入支援</button>
                </div>

                <div style="max-height: 400px; overflow-y: auto; border:1px solid #eee;">
                    <table style="width:100%;">
                        <thead style="background:#eee; position:sticky; top:0;">
                            <tr>
                                <th style="width:15%;">員編</th>
                                <th style="width:20%;">姓名</th>
                                <th style="width:15%;">層級</th>
                                <th style="width:20%;">組別</th>
                                <th style="width:15%;">身份</th>
                                <th style="width:15%;">操作</th>
                            </tr>
                        </thead>
                        <tbody id="preStaffBody">
                            </tbody>
                    </table>
                </div>
            </div>

        </div>

        <div style="text-align:right; margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
            <button class="btn btn-close" onclick="preScheduleManager.closeModal()">取消</button>
            <button class="btn btn-add" onclick="preScheduleManager.saveData()">儲存設定</button>
        </div>
    </div>
</div>
