<div class="page-section active">
    <h2><i class="fas fa-chart-bar"></i> 系統統計</h2>
    
    <!-- 篩選工具欄 -->
    <div class="toolbar" style="margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
        <!-- 單位選擇 -->
        <div class="form-group" style="margin: 0;">
            <label style="margin-right: 10px;">選擇單位：</label>
            <select id="unitFilter" class="form-control" style="width: 200px;">
                <option value="">全部</option>
            </select>
        </div>
        
        <!-- 查詢方式選擇 -->
        <div class="form-group" style="margin: 0;">
            <label style="margin-right: 10px;">查詢方式：</label>
            <select id="queryType" class="form-control" style="width: 150px;" onchange="systemStatisticsManager.toggleQueryMode()">
                <option value="month">月份</option>
                <option value="range">區間</option>
            </select>
        </div>
        
        <!-- 月份選擇 -->
        <div class="form-group" id="monthGroup" style="margin: 0;">
            <label style="margin-right: 10px;">選擇月份：</label>
            <input type="month" id="statisticsMonth" class="form-control" style="width: 150px;">
        </div>
        
        <!-- 區間選擇 (預設隱藏) -->
        <div class="form-group" id="rangeGroup" style="margin: 0; display: none;">
            <label style="margin-right: 10px;">開始月份：</label>
            <input type="month" id="startMonth" class="form-control" style="width: 150px;">
            <label style="margin-left: 15px; margin-right: 10px;">結束月份：</label>
            <input type="month" id="endMonth" class="form-control" style="width: 150px;">
        </div>
        
        <!-- 查詢按鈕 -->
        <button class="btn btn-primary" onclick="systemStatisticsManager.loadStatistics()">查詢</button>
        <button class="btn btn-secondary" onclick="systemStatisticsManager.exportToCSV()" style="margin-left: 10px;">導出 CSV</button>
    </div>
    
    <!-- 呈現方式選擇 -->
    <div class="toolbar" style="margin-bottom: 20px;">
        <label style="margin-right: 10px;">呈現方式：</label>
        <select id="displayMode" class="form-control" style="width: 200px;" onchange="systemStatisticsManager.switchDisplayMode()">
            <option value="cards">卡片式統計（預設）</option>
            <option value="table">表格式詳細列表</option>
            <option value="chart">圖表呈現</option>
        </select>
    </div>
    
    <!-- 卡片式統計 (預設) -->
    <div id="cardsView" class="statistics-view">
        <div class="score-cards-grid">
            <!-- 排班過程 -->
            <div class="score-card">
                <h5>排班次數</h5>
                <h2 id="schedulingAttempts">-</h2>
            </div>
            
            <div class="score-card">
                <h5>排班時間</h5>
                <h2 id="schedulingTime">-</h2>
            </div>
            
            <!-- 班表評分 -->
            <div class="score-card">
                <h5>原始評分</h5>
                <h2 id="originalScore">-</h2>
            </div>
            
            <div class="score-card">
                <h5>調整後評分</h5>
                <h2 id="currentScore">-</h2>
            </div>
            
            <div class="score-card">
                <h5>評分變化</h5>
                <h2 id="scoreImprovement" style="color: #27ae60;">-</h2>
            </div>
            
            <!-- 缺班統計 -->
            <div class="score-card">
                <h5>整體缺班率</h5>
                <h2 id="overallVacancyRate" style="color: #e74c3c;">-</h2>
            </div>
            
            <!-- 修正統計 -->
            <div class="score-card">
                <h5>修正次數</h5>
                <h2 id="totalAdjustments">-</h2>
            </div>
            
            <div class="score-card">
                <h5>修正率</h5>
                <h2 id="adjustmentRate" style="color: #f39c12;">-</h2>
            </div>
            
            <!-- 換班統計 -->
            <div class="score-card">
                <h5>換班次數</h5>
                <h2 id="totalExchanges">-</h2>
            </div>
        </div>
        
        <!-- 詳細統計信息 -->
        <div style="margin-top: 30px;">
            <h3>詳細統計信息</h3>
            
            <!-- 班別缺班率 -->
            <div style="margin-top: 20px;">
                <h4>班別缺班率</h4>
                <table class="table" id="vacancyByShiftTable">
                    <thead>
                        <tr>
                            <th>班別</th>
                            <th>缺班率</th>
                            <th>缺班數</th>
                            <th>所需班數</th>
                        </tr>
                    </thead>
                    <tbody id="vacancyByShiftBody">
                    </tbody>
                </table>
            </div>
            
            <!-- 調整原因分布 -->
            <div style="margin-top: 20px;">
                <h4>調整原因分布</h4>
                <table class="table" id="adjustmentReasonTable">
                    <thead>
                        <tr>
                            <th>調整原因</th>
                            <th>調整次數</th>
                            <th>百分比</th>
                        </tr>
                    </thead>
                    <tbody id="adjustmentReasonBody">
                    </tbody>
                </table>
            </div>
            
            <!-- 換班原因分布 -->
            <div style="margin-top: 20px;">
                <h4>換班原因分布</h4>
                <table class="table" id="exchangeReasonTable">
                    <thead>
                        <tr>
                            <th>換班事由</th>
                            <th>次數</th>
                            <th>百分比</th>
                        </tr>
                    </thead>
                    <tbody id="exchangeReasonBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- 表格式詳細列表 (隱藏) -->
    <div id="tableView" class="statistics-view" style="display: none;">
        <div class="table-container">
            <table id="statisticsTable">
                <thead>
                    <tr>
                        <th>月份</th>
                        <th>排班次數</th>
                        <th>排班時間</th>
                        <th>原始評分</th>
                        <th>調整後評分</th>
                        <th>評分變化</th>
                        <th>缺班率</th>
                        <th>修正率</th>
                        <th>換班次數</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="statisticsTableBody">
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 圖表呈現 (隱藏) -->
    <div id="chartView" class="statistics-view" style="display: none;">
        <div style="margin-bottom: 30px;">
            <h3>班表評分趨勢</h3>
            <div id="scoreChart" style="width: 100%; height: 400px;"></div>
        </div>
        
        <div style="margin-bottom: 30px;">
            <h3>缺班率趨勢</h3>
            <div id="vacancyChart" style="width: 100%; height: 400px;"></div>
        </div>
        
        <div style="margin-bottom: 30px;">
            <h3>修正率趨勢</h3>
            <div id="adjustmentChart" style="width: 100%; height: 400px;"></div>
        </div>
    </div>
    
    <!-- AI 分析報告 -->
    <div id="analysisReportSection" style="margin-top: 40px; display: none;">
        <h3><i class="fas fa-lightbulb"></i> AI 分析報告</h3>
        
        <div id="insightsContainer" style="margin-top: 20px;">
            <!-- 動態插入分析洞察 -->
        </div>
        
        <div id="recommendationsContainer" style="margin-top: 20px;">
            <!-- 動態插入改進建議 -->
        </div>
    </div>
</div>

<style>
.statistics-view {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.insight-item {
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.insight-item.critical {
    background-color: #fadbd8;
    border-left-color: #e74c3c;
}

.insight-item.warning {
    background-color: #fef5e7;
    border-left-color: #f39c12;
}

.insight-item.info {
    background-color: #d5f4e6;
    border-left-color: #27ae60;
}

.recommendation-item {
    padding: 10px 15px;
    margin-bottom: 8px;
    background-color: #f0f8ff;
    border-left: 3px solid #3498db;
    border-radius: 4px;
}
</style>
