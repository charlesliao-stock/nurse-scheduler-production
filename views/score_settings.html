<div class="page-section active">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0; color: #2c3e50;"><i class="fas fa-star"></i> 班表評分設定</h2>
    </div>
    
    <div class="toolbar">
        <label style="margin-right:10px; font-weight:bold; color:#555;">設定單位:</label>
        <select id="scoreUnitSelect" class="form-control" style="width: 250px; display:inline-block;">
            <option value="">載入中...</option>
        </select>
        <button class="btn btn-add" onclick="scoreSettingsManager.saveData()" style="margin-left:auto;">
            <i class="fas fa-save"></i> 儲存評分設定
        </button>
    </div>

    <div id="scoreSettingsContainer" class="rules-container" style="display:none;">
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="weights" onclick="scoreSettingsManager.switchTab('weights')">
                <i class="fas fa-balance-scale"></i> 1. 權重設定
            </button>
            <button class="tab-btn" data-tab="thresholds" onclick="scoreSettingsManager.switchTab('thresholds')">
                <i class="fas fa-sliders-h"></i> 2. 閾值標準
            </button>
            <button class="tab-btn" data-tab="preview" onclick="scoreSettingsManager.switchTab('preview')">
                <i class="fas fa-eye"></i> 3. 預覽說明
            </button>
        </div>

        <div class="tab-content-wrapper">
            
            <!-- Tab 1: 權重設定 -->
            <div id="tab-weights" class="tab-content active">
                <div class="section-title" style="border-left-color: #3498db;">評分項目權重分配</div>
                <p class="section-desc">總分 100%,請分配各評分項目的權重比例。</p>
                
                <div class="rule-card">
                    <div class="rule-header">權重分配 (總和應為 100%)</div>
                    <div class="rule-body">
                        <div class="form-row" style="margin-bottom:15px;">
                            <div class="form-col">
                                <label><i class="fas fa-tachometer-alt" style="color:#3498db;"></i> 排班效率 (Efficiency)</label>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="range" id="weight_efficiency" min="0" max="100" value="40" 
                                           oninput="scoreSettingsManager.updateWeightDisplay()" 
                                           style="flex:1;">
                                    <span id="display_efficiency" style="min-width:60px; font-weight:bold; color:#3498db;">40%</span>
                                </div>
                                <small style="color:#666;">人力缺額最少、滿足需求度</small>
                            </div>
                        </div>

                        <div class="form-row" style="margin-bottom:15px;">
                            <div class="form-col">
                                <label><i class="fas fa-bed" style="color:#e74c3c;"></i> 疲勞度控制 (Fatigue)</label>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="range" id="weight_fatigue" min="0" max="100" value="25" 
                                           oninput="scoreSettingsManager.updateWeightDisplay()" 
                                           style="flex:1;">
                                    <span id="display_fatigue" style="min-width:60px; font-weight:bold; color:#e74c3c;">25%</span>
                                </div>
                                <small style="color:#666;">連續工作天數、夜班頻率</small>
                            </div>
                        </div>

                        <div class="form-row" style="margin-bottom:15px;">
                            <div class="form-col">
                                <label><i class="fas fa-smile" style="color:#f39c12;"></i> 滿意度 (Satisfaction)</label>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="range" id="weight_satisfaction" min="0" max="100" value="20" 
                                           oninput="scoreSettingsManager.updateWeightDisplay()" 
                                           style="flex:1;">
                                    <span id="display_satisfaction" style="min-width:60px; font-weight:bold; color:#f39c12;">20%</span>
                                </div>
                                <small style="color:#666;">預班達成率、志願滿足度</small>
                            </div>
                        </div>

                        <div class="form-row" style="margin-bottom:15px;">
                            <div class="form-col">
                                <label><i class="fas fa-balance-scale" style="color:#27ae60;"></i> 公平性 (Fairness)</label>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="range" id="weight_fairness" min="0" max="100" value="10" 
                                           oninput="scoreSettingsManager.updateWeightDisplay()" 
                                           style="flex:1;">
                                    <span id="display_fairness" style="min-width:60px; font-weight:bold; color:#27ae60;">10%</span>
                                </div>
                                <small style="color:#666;">休假天數分配均勻度</small>
                            </div>
                        </div>

                        <div class="form-row" style="margin-bottom:15px;">
                            <div class="form-col">
                                <label><i class="fas fa-dollar-sign" style="color:#9b59b6;"></i> 成本控制 (Cost)</label>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="range" id="weight_cost" min="0" max="100" value="5" 
                                           oninput="scoreSettingsManager.updateWeightDisplay()" 
                                           style="flex:1;">
                                    <span id="display_cost" style="min-width:60px; font-weight:bold; color:#9b59b6;">5%</span>
                                </div>
                                <small style="color:#666;">加班時數、人力成本</small>
                            </div>
                        </div>

                        <div style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:5px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-weight:bold;">權重總和:</span>
                            <span id="totalWeight" style="font-size:1.5rem; font-weight:bold; color:#2c3e50;">100%</span>
                        </div>
                        <div id="weightWarning" style="display:none; margin-top:10px; padding:10px; background:#fff3cd; color:#856404; border-radius:4px;">
                            <i class="fas fa-exclamation-triangle"></i> 警告:權重總和必須為 100%
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: 閾值標準 -->
            <div id="tab-thresholds" class="tab-content">
                <div class="section-title" style="border-left-color: #e67e22;">評分標準與閾值</div>
                <p class="section-desc">設定各項目的評分標準,用於計算 0-5 分的等級。</p>

                <div class="rule-card">
                    <div class="rule-header">1. 疲勞度評分標準</div>
                    <div class="rule-body">
                        <div class="form-inline-group" style="margin-bottom:10px;">
                            <div class="form-item">
                                <label>最大連續工作天數:</label>
                                <input type="number" id="threshold_maxConsecutive" value="6" class="form-control small-input"> 天
                            </div>
                        </div>
                        <small style="color:#666;">超過此天數視為違規,每次違規扣分。</small>

                        <div class="form-inline-group" style="margin-top:15px;">
                            <div class="form-item">
                                <label>違規容忍度:</label>
                                <select id="threshold_fatigueLevel" class="form-control" style="width:200px;">
                                    <option value="strict">嚴格 (0次=5分, 1次=3分, 2次=1分)</option>
                                    <option value="moderate" selected>中等 (0次=5分, ≤2次=4分, ≤5次=3分)</option>
                                    <option value="relaxed">寬鬆 (0次=5分, ≤5次=4分, >5次=2分)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="rule-card">
                    <div class="rule-header">2. 公平性評分標準</div>
                    <div class="rule-body">
                        <div class="form-inline-group">
                            <div class="form-item">
                                <label>休假天數標準差閾值:</label>
                                <input type="number" id="threshold_offStdDev" value="1.5" step="0.1" class="form-control small-input"> 天
                            </div>
                        </div>
                        <small style="color:#666;">標準差越小代表分配越公平。<br>
                        &lt; 1.0 = 極佳 (5分) | &lt; 1.5 = 良好 (4分) | &lt; 2.0 = 尚可 (3分) | ≥ 2.0 = 不佳 (2分)</small>
                    </div>
                </div>

                <div class="rule-card">
                    <div class="rule-header">3. 效率評分標準</div>
                    <div class="rule-body">
                        <div class="form-inline-group">
                            <div class="form-item">
                                <label>缺額容忍比例:</label>
                                <input type="number" id="threshold_gapTolerance" value="5" class="form-control small-input"> %
                            </div>
                        </div>
                        <small style="color:#666;">允許的缺額百分比。0% = 完全滿足 (5分) | ≤5% = 良好 (4分) | >10% = 不佳 (&lt;3分)</small>
                    </div>
                </div>
            </div>

            <!-- Tab 3: 預覽說明 -->
            <div id="tab-preview" class="tab-content">
                <div class="section-title" style="border-left-color: #27ae60;">評分系統說明</div>
                
                <div class="rule-card" style="background:#f0f8ff;">
                    <div class="rule-header" style="color:#2980b9;">評分機制總覽</div>
                    <div class="rule-body">
                        <p style="line-height:1.8;">班表評分系統採用 <strong>多維度加權評分</strong> 方式,將班表品質量化為 0-100 分:</p>
                        <ul style="line-height:1.8;">
                            <li>每個項目獨立計算 <strong>0-5 分</strong> (5分為最佳)</li>
                            <li>根據您設定的權重進行加權平均</li>
                            <li>最終換算為百分比顯示</li>
                        </ul>
                        
                        <div style="margin-top:20px; padding:15px; background:white; border-left:4px solid #3498db;">
                            <strong>計算公式:</strong><br>
                            總分 = (效率分數 × 效率權重) + (疲勞分數 × 疲勞權重) + ... <br>
                            百分比 = (總分 / 5) × 100%
                        </div>
                    </div>
                </div>

                <div class="rule-card">
                    <div class="rule-header">各項目評分細節</div>
                    <div class="rule-body">
                        <h4 style="color:#3498db; margin-top:0;"><i class="fas fa-tachometer-alt"></i> 排班效率</h4>
                        <p>檢查每日各班別是否達到人力需求,統計缺額比例:</p>
                        <ul>
                            <li>0% 缺額 → 5分 (完美)</li>
                            <li>≤ 5% 缺額 → 4分 (良好)</li>
                            <li>5-10% 缺額 → 3分 (尚可)</li>
                            <li>&gt; 10% 缺額 → 1-2分 (不佳)</li>
                        </ul>

                        <h4 style="color:#e74c3c; margin-top:20px;"><i class="fas fa-bed"></i> 疲勞度控制</h4>
                        <p>檢查是否有以下違規情況:</p>
                        <ul>
                            <li>連續工作超過設定天數</li>
                            <li>夜班後接白班 (休息不足)</li>
                            <li>違規次數越少分數越高</li>
                        </ul>

                        <h4 style="color:#f39c12; margin-top:20px;"><i class="fas fa-smile"></i> 滿意度</h4>
                        <p>評估同仁需求滿足程度:</p>
                        <ul>
                            <li>預班 (REQ_OFF) 滿足率</li>
                            <li>志願班別達成率</li>
                            <li>包班需求符合度</li>
                        </ul>

                        <h4 style="color:#27ae60; margin-top:20px;"><i class="fas fa-balance-scale"></i> 公平性</h4>
                        <p>使用統計學標準差衡量:</p>
                        <ul>
                            <li>休假天數的標準差</li>
                            <li>夜班次數的標準差 (分包班/非包班組)</li>
                            <li>標準差越小代表分配越公平</li>
                        </ul>

                        <h4 style="color:#9b59b6; margin-top:20px;"><i class="fas fa-dollar-sign"></i> 成本控制</h4>
                        <p>評估人力成本效益 (進階功能):</p>
                        <ul>
                            <li>加班時數統計</li>
                            <li>臨時調班次數</li>
                            <li>目前為預留項目,可依機構需求自訂</li>
                        </ul>
                    </div>
                </div>

                <div class="rule-card" style="background:#fff3cd; border-left-color:#f39c12;">
                    <div class="rule-header" style="color:#856404;"><i class="fas fa-lightbulb"></i> 使用建議</div>
                    <div class="rule-body" style="color:#856404;">
                        <p><strong>權重設定建議:</strong></p>
                        <ul>
                            <li><strong>重視人力滿足</strong> → 提高「效率」權重至 40-50%</li>
                            <li><strong>重視員工健康</strong> → 提高「疲勞」權重至 30-35%</li>
                            <li><strong>重視員工意願</strong> → 提高「滿意度」權重至 25-30%</li>
                            <li><strong>重視公平分配</strong> → 提高「公平性」權重至 15-20%</li>
                        </ul>
                        
                        <p style="margin-top:15px;"><strong>評分參考:</strong></p>
                        <ul>
                            <li>90 分以上 → 優秀班表</li>
                            <li>80-90 分 → 良好班表</li>
                            <li>70-80 分 → 合格班表</li>
                            <li>70 分以下 → 需要調整</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
/* 複用排班規則的樣式 */
.rules-container { 
    background: #fff; 
    border-radius: 8px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
    min-height: 600px; 
    overflow: hidden; 
}

.tab-nav { 
    display: flex; 
    background: #f8f9fa; 
    border-bottom: 1px solid #eee; 
}

.tab-btn { 
    flex: 1; 
    padding: 15px; 
    border: none; 
    background: transparent; 
    font-weight: 600; 
    color: #7f8c8d; 
    cursor: pointer; 
    transition: all 0.2s; 
    border-bottom: 3px solid transparent; 
}

.tab-btn:hover { 
    background: #ecf0f1; 
    color: #2c3e50; 
}

.tab-btn.active { 
    color: #3498db; 
    border-bottom-color: #3498db; 
    background: #fff; 
}

.tab-content-wrapper { 
    padding: 30px; 
}

.tab-content { 
    display: none; 
    animation: fadeIn 0.3s; 
}

.tab-content.active { 
    display: block; 
}

.section-title { 
    font-size: 1.2rem; 
    font-weight: bold; 
    color: #2c3e50; 
    border-left: 5px solid #3498db; 
    padding-left: 15px; 
    margin-bottom: 15px; 
}

.section-desc { 
    color: #7f8c8d; 
    margin-bottom: 20px; 
    font-size: 0.95rem; 
}

.rule-card { 
    background: #fff; 
    border: 1px solid #eee; 
    border-radius: 8px; 
    padding: 20px; 
    margin-bottom: 15px; 
    border-left: 5px solid #bdc3c7; 
    transition: all 0.2s ease-in-out; 
}

.rule-card:hover { 
    border-left-color: #3498db !important; 
    background-color: #ebf5fb !important; 
    transform: translateY(-2px); 
    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.15); 
}

.rule-header { 
    font-size: 16px; 
    font-weight: bold; 
    color: #2c3e50; 
    margin-bottom: 8px; 
}

.rule-body { 
    font-size: 13px; 
    color: #666; 
    line-height: 1.5; 
}

.form-control { 
    padding: 6px 10px; 
    border: 1px solid #ccc; 
    border-radius: 4px; 
    font-size: 13px; 
}

.small-input { 
    width: 80px; 
    text-align: center; 
}

.form-inline-group { 
    display: flex; 
    align-items: center; 
    gap: 20px; 
    flex-wrap: wrap; 
}

.form-item { 
    display: flex; 
    align-items: center; 
    gap: 8px; 
}

.form-row { 
    display: flex; 
    gap: 20px; 
    margin-bottom: 10px; 
}

.form-col { 
    flex: 1; 
    display: flex; 
    flex-direction: column; 
    gap: 5px; 
}

.form-col label { 
    font-size: 13px; 
    font-weight: bold; 
    color: #555; 
}

@keyframes fadeIn { 
    from { opacity: 0; transform: translateY(5px); } 
    to { opacity: 1; transform: translateY(0); } 
}
</style>
