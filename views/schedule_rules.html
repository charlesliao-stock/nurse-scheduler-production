<div class="page-section active">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0; color:#2c3e50;"><i class="fas fa-cogs"></i> 排班規則設定</h2>
    </div>
    
    <div class="toolbar" style="background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-bottom:25px; display:flex; align-items:center;">
        <label style="margin-right:15px; font-weight:bold; font-size:1.1rem;">設定單位：</label>
        <select id="ruleUnitSelect" style="padding:10px; border-radius:6px; border:1px solid #ccc; width: 300px; font-size:1rem;">
            <option value="">載入中...</option>
        </select>
        <div style="margin-left:auto;">
            <button class="btn btn-add" onclick="scheduleRuleManager.saveData()" style="padding:10px 25px; font-size:1rem; box-shadow: 0 4px 6px rgba(46, 204, 113, 0.2);">
                <i class="fas fa-save"></i> 儲存所有設定
            </button>
        </div>
    </div>

    <div id="rulesContainer" style="display:none;">
        
        <div class="tab-header" style="display:flex; gap:10px; margin-bottom:20px;">
            <button class="tab-btn active" onclick="scheduleRuleManager.switchTab('norms')" style="flex:1; padding:15px; border:none; background:#e0e6ed; color:#555; border-radius:8px; font-weight:bold; cursor:pointer; transition:0.3s;">
                <i class="fas fa-ruler-combined"></i> 單位規範
            </button>
            <button class="tab-btn" onclick="scheduleRuleManager.switchTab('ai')" style="flex:1; padding:15px; border:none; background:#e0e6ed; color:#555; border-radius:8px; font-weight:bold; cursor:pointer; transition:0.3s;">
                <i class="fas fa-robot"></i> AI 運算參數
            </button>
            <button class="tab-btn" onclick="scheduleRuleManager.switchTab('weights')" style="flex:1; padding:15px; border:none; background:#e0e6ed; color:#555; border-radius:8px; font-weight:bold; cursor:pointer; transition:0.3s;">
                <i class="fas fa-balance-scale"></i> 進階權重
            </button>
        </div>

        <div class="tab-content-wrapper">
            
            <div id="tab-norms" class="tab-content active">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    
                    <div class="rule-card">
                        <div class="card-header"><i class="fas fa-clock"></i> 工時與間隔限制</div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>班別最小間隔時數 (小時)</label>
                                <input type="number" id="input_minGapHours" class="input-modern" value="11">
                                <small>法規建議 11 小時 (舊版設定若勾選 11hr 將自動帶入 11)</small>
                            </div>
                            <div class="form-group">
                                <label>連續上班天數上限 (天)</label>
                                <input type="number" id="input_maxConsDays" class="input-modern" value="6">
                            </div>
                            <div class="form-group">
                                <label>夜班公平標準 (變異數容忍值)</label>
                                <input type="number" id="input_fairNightVar" class="input-modern" value="2">
                                <small>數值越小，大家的大夜/小夜班數會越平均 (預設 2)</small>
                            </div>
                        </div>
                    </div>

                    <div class="rule-card" style="border-left: 5px solid #e74c3c;">
                        <div class="card-header" style="color:#c0392b;"><i class="fas fa-fire-extinguisher"></i> 救火機制 (Firefighting)</div>
                        <div class="card-body">
                            <div class="switch-container">
                                <div style="flex:1;">
                                    <label style="font-weight:bold; color:#e74c3c;">啟用自動填補缺口</label>
                                    <div style="font-size:0.85rem; color:#666; margin-top:5px;">
                                        當人力不足時，允許 AI <b>忽略員工的「非偏好」設定</b>，強制指派符合法規的人員上班。
                                    </div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="check_enableFirefighting">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div id="tab-ai" class="tab-content">
                <div class="rule-card">
                    <div class="card-header"><i class="fas fa-microchip"></i> 運算核心設定</div>
                    <div class="card-body">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                            <div class="form-group">
                                <label>容許誤差 (Tolerance)</label>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="number" id="ai_tolerance" class="input-modern" value="2">
                                    <span>天</span>
                                </div>
                                <small>兩人休假/夜班數差異在此範圍內，視為平等。</small>
                            </div>
                            <div class="form-group">
                                <label>回溯深度 (Backtrack Depth)</label>
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="number" id="ai_backtrack_depth" class="input-modern" value="3">
                                    <span>天</span>
                                </div>
                                <small>遇到死局時，AI 往回修改的天數。</small>
                            </div>
                            <div class="form-group">
                                <label>單格嘗試上限 (Max Attempts)</label>
                                <input type="number" id="ai_max_attempts" class="input-modern" value="20">
                                <small>防止 AI 在同一格卡太久 (預設 20 次)</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-weights" class="tab-content">
                <div class="rule-card">
                    <div class="card-header"><i class="fas fa-sliders-h"></i> 評分權重 (進階)</div>
                    <div class="card-body">
                        <div class="alert-box">
                            <i class="fas fa-info-circle"></i> 此處設定影響 AI 對「完美班表」的定義。若不清楚建議維持預設值。
                        </div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:15px; margin-top:15px;">
                            <div class="form-group">
                                <label>勞逸平均權重</label>
                                <input type="number" id="ai_w_balance" class="input-modern" value="200">
                            </div>
                            <div class="form-group">
                                <label>連續性權重</label>
                                <input type="number" id="ai_w_continuity" class="input-modern" value="50">
                            </div>
                            <div class="form-group">
                                <label>積假權重</label>
                                <input type="number" id="ai_w_surplus" class="input-modern" value="150">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    .rule-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        overflow: hidden;
        border: 1px solid #eee;
        margin-bottom: 20px;
    }
    .card-header {
        background: #f8f9fa;
        padding: 15px 20px;
        font-weight: bold;
        color: #2c3e50;
        border-bottom: 1px solid #eee;
        display: flex; align-items: center; gap: 10px;
    }
    .card-body { padding: 20px; }
    .input-modern {
        width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; transition: 0.2s;
    }
    .input-modern:focus { border-color: #3498db; outline: none; box-shadow: 0 0 5px rgba(52, 152, 219, 0.2); }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
    .form-group small { display: block; margin-top: 5px; color: #888; font-size: 0.85rem; }
    .tab-content { display: none; animation: fadeIn 0.3s; }
    .tab-content.active { display: block; }
    .tab-btn.active { background: #3498db !important; color: white !important; box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3); }
    .alert-box { background: #e8f6f3; color: #0e6251; padding: 15px; border-radius: 6px; font-size: 0.9rem; }
    .switch-container { display: flex; align-items: center; justify-content: space-between; }
    .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #e74c3c; }
    input:checked + .slider:before { transform: translateX(24px); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
</style>
