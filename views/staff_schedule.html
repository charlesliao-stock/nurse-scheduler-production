<div class="page-section active">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0;"><i class="fas fa-user-clock"></i> 我的班表查詢</h2>
    </div>
    
    <div class="toolbar" style="margin-bottom: 20px; background:white; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;">
        <div style="display:flex; gap:15px; align-items:center;">
            <div class="form-group" style="margin:0;">
                <label style="font-weight:bold; margin-right:5px;">月份：</label>
                <input type="month" id="scheduleMonth" class="form-control" style="width: 160px; display:inline-block;">
            </div>
            <button class="btn btn-primary" onclick="staffScheduleManager.loadData()">
                <i class="fas fa-search"></i> 查詢
            </button>
        </div>

        <div style="display:flex; align-items:center;">
            <label class="switch-label" style="cursor:pointer; display:flex; align-items:center; user-select:none;">
                <input type="checkbox" id="checkShowAllStaff" onchange="staffScheduleManager.toggleViewMode()" style="width:18px; height:18px; margin-right:8px;">
                <span style="font-size:1rem; color:#2c3e50;">顯示全單位班表</span>
            </label>
        </div>
    </div>
    
    <div id="personalStatsContainer" class="score-cards-grid" style="grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); margin-bottom: 20px; gap: 10px;">
        <div class="score-card" style="padding: 10px;">
            <h5 style="color:#7f8c8d; margin:0; font-size: 0.9rem;">上班總數</h5>
            <h2 id="statTotalShifts" style="color:#2c3e50; margin:5px 0; font-size: 1.5rem;">-</h2>
        </div>
        <div class="score-card" style="padding: 10px;">
            <h5 style="color:#7f8c8d; margin:0; font-size: 0.9rem;">休假天數</h5>
            <h2 id="statTotalOff" style="color:#27ae60; margin:5px 0; font-size: 1.5rem;">-</h2>
        </div>
        <div class="score-card" style="padding: 10px;">
            <h5 style="color:#7f8c8d; margin:0; font-size: 0.9rem;">假日休</h5>
            <h2 id="statHolidayOff" style="color:#e67e22; margin:5px 0; font-size: 1.5rem;">-</h2>
        </div>
        <div class="score-card" style="padding: 10px;">
            <h5 style="color:#7f8c8d; margin:0; font-size: 0.9rem;">白班(D)</h5>
            <h2 id="statDay" style="color:#3498db; margin:5px 0; font-size: 1.5rem;">-</h2>
        </div>
        <div class="score-card" style="padding: 10px;">
            <h5 style="color:#7f8c8d; margin:0; font-size: 0.9rem;">小夜(E)</h5>
            <h2 id="statEvening" style="color:#9b59b6; margin:5px 0; font-size: 1.5rem;">-</h2>
        </div>
        <div class="score-card" style="padding: 10px;">
            <h5 style="color:#7f8c8d; margin:0; font-size: 0.9rem;">大夜(N)</h5>
            <h2 id="statNight" style="color:#34495e; margin:5px 0; font-size: 1.5rem;">-</h2>
        </div>
    </div>

    <div id="horizontalScheduleWrapper" class="card" style="padding: 0; overflow: hidden; display:none;">
        <div id="myScheduleView" style="overflow-x: auto;">
            <table class="table table-bordered text-center" style="margin:0;">
                <thead>
                    <tr id="row-weekday" style="background:#f8f9fa;">
                        <th style="width:100px; background:#fff;">星期</th>
                    </tr>
                    <tr id="row-date">
                        <th style="width:100px; background:#fff;">日期</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="row-shift">
                        <th style="width:100px; background:#eef2f3; vertical-align: middle;">我的班別</th>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="unitScheduleView" style="display:none; overflow:auto; max-height: 600px;">
            <table class="table table-bordered table-sm text-center" style="min-width: 1500px; margin:0;">
                <thead id="unitHead" class="thead-light" style="position:sticky; top:0; z-index:10;"></thead>
                <tbody id="unitBody"></tbody>
            </table>
        </div>
    </div>

    <div id="noDataMessage" style="display:none; text-align:center; padding:50px; color:#999;"></div>
</div>

<div id="exchangeModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-top: 0;">
            <i class="fas fa-exchange-alt"></i> 提出換班申請
        </h3>
        
        <div class="alert alert-info" id="exchangeInfo" style="margin-bottom:15px;"></div>

        <div style="display:flex; gap:15px; margin-bottom:15px;">
            <div style="flex:1;">
                <label>選擇交換對象 <span style="color:red;">*</span></label>
                <select id="exchangeTargetSelect" class="form-control" style="font-family: monospace;">
                    <option value="">載入中...</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>換班原因 (必填) <span style="color:red;">*</span></label>
            <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:5px;">
                <label><input type="radio" name="reason" value="personal"> 個人因素</label>
                <label><input type="radio" name="reason" value="sick"> 病假/身體不適</label>
                <label><input type="radio" name="reason" value="family"> 家庭因素</label>
                <label><input type="radio" name="reason" value="course"> 上課/進修</label>
                <label><input type="radio" name="reason" value="official"> 公務/會議</label>
                <label><input type="radio" name="reason" value="other" onchange="document.getElementById('otherReasonBox').style.display='block'"> 其他</label>
            </div>
            <textarea id="otherReasonBox" class="form-control" rows="2" placeholder="請填寫具體原因..." style="display:none; margin-top:5px;"></textarea>
        </div>

        <div id="validationResult" style="display:none; margin-top:15px; padding:10px; border-radius:5px;"></div>

        <div style="text-align:right; margin-top:20px; border-top:1px solid #eee; padding-top:15px;">
            <button class="btn btn-secondary" onclick="staffScheduleManager.closeExchangeModal()">取消</button>
            <button class="btn btn-primary" onclick="staffScheduleManager.submitExchange()">送出申請</button>
        </div>
    </div>
</div>
