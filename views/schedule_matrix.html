<div class="page-section active" style="padding:0; height:100vh; display:flex; flex-direction:column;">
    
    <div style="padding:10px 20px; background:white; border-bottom:1px solid #ddd; display:flex; align-items:center; justify-content:space-between; flex-shrink:0;">
        <div style="display:flex; align-items:center; gap:15px;">
            <button class="btn" onclick="history.back()" style="background:#95a5a6; padding: 5px 10px; font-size: 0.9rem;">
                <i class="fas fa-arrow-left"></i> 返回列表
            </button>
            <h3 style="margin:0;" id="schTitle">排班載入中...</h3>
            <span id="schStatus" class="badge"></span>
        </div>
        
        <div style="display:flex; align-items:center; gap:8px;">
            <button class="btn" style="background:#8e44ad;" onclick="scheduleEditorManager.runAI()">
                <i class="fas fa-robot"></i> AI 自動排班
            </button>
            <span style="border-left:1px solid #ccc; height:20px; margin:0 5px;"></span>
            <button class="btn btn-primary" onclick="scheduleEditorManager.saveDraft()">
                <i class="fas fa-save"></i> 儲存
            </button>
            <button class="btn btn-success" onclick="scheduleEditorManager.publishSchedule()">
                <i class="fas fa-paper-plane"></i> 發布
            </button>
        </div>
    </div>

    <div style="flex:1; display:flex; overflow:hidden;">
        
        <div id="matrixArea" style="flex:1; overflow:auto; position:relative; border-right:1px solid #ddd;">
            <div id="gapPool" style="position:sticky; top:0; z-index:30; background:#fff3cd; border-bottom:1px solid #e0c46c; padding:5px; display:flex; gap:5px; align-items:center; overflow-x:auto; white-space:nowrap; height: 50px;">
                <span style="font-weight:bold; color:#856404; margin-right:10px;"><i class="fas fa-exclamation-triangle"></i> 人力缺口:</span>
                <div id="gapItems" style="display:flex; gap:5px;"></div>
            </div>

            <table id="scheduleMatrix" oncontextmenu="return false;">
                <thead id="schHead"></thead>
                <tbody id="schBody"></tbody>
                <tfoot id="schFoot" style="position:sticky; bottom:0; background:#f9f9f9; z-index:25; font-weight:bold; border-top:2px solid #ddd;"></tfoot>
            </table>
        </div>

        <div id="statsPanel" style="width:280px; background:#f8f9fa; border-left:1px solid #ddd; display:flex; flex-direction:column; flex-shrink:0;">
            <div style="padding:10px; background:#e9ecef; font-weight:bold; border-bottom:1px solid #ddd;">
                <i class="fas fa-chart-bar"></i> 即時統計
            </div>
            <div style="flex:1; overflow-y:auto; padding:10px;">
                <table style="width:100%; font-size:0.9rem;">
                    <thead>
                        <tr>
                            <th style="text-align:left;">姓名</th>
                            <th title="總休假">OFF</th>
                            <th title="假日休">假</th>
                            <th title="大夜數">N</th>
                            <th title="小夜數">E</th>
                        </tr>
                    </thead>
                    <tbody id="sideStatsBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="schContextMenu" class="context-menu" style="display:none;">
    <div class="menu-header">設定班別</div>
    <div id="schMenuOptions" class="menu-options"></div>
</div>

<style>
    /* 班別方塊樣式 (用於缺額池與表格) */
    .shift-block {
        display: inline-block; padding: 2px 6px; border-radius: 3px; 
        font-size: 0.85rem; font-weight: bold; cursor: grab;
        border: 1px solid rgba(0,0,0,0.1); user-select: none;
    }
    .shift-block:active { cursor: grabbing; }
    
    /* 衝突警告樣式 */
    .cell-conflict {
        box-shadow: inset 0 0 0 2px #e74c3c !important;
        position: relative;
    }
    .cell-conflict::after {
        content: '!'; position: absolute; top: -5px; right: -5px;
        background: #e74c3c; color: white; border-radius: 50%;
        width: 15px; height: 15px; font-size: 10px;
        display: flex; justify-content: center; align-items: center;
    }
</style>
